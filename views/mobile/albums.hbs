{{#extend "mStyle"}}
    <link rel="stylesheet" href="/mobile/css/homeD.css">
    <link rel="stylesheet" href="/common/css/swiper.min.css">
    <style>
        html, body {
            position: relative;
            height: 100%;
        }

        body {
            background: #fff;
            font-size: 14px;
            color: #000;
            margin: 0;
            padding: 0;
        }

        .swiper-container {
            height: 100%;
            width: 100%;
            position: relative;
            moz-user-select: -moz-none;
            -moz-user-select: none;
            -o-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;

        }

        .swiper-wrapper {
            position: relative;
            z-index: 2;
            background: #fff;
        }

        .swiper-slide {
            /* Center slide text vertically */
            display: -webkit-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            -webkit-align-items: center;
            align-items: center;
            flex-direction: column;
            flex-shrink: 0;
            margin: 0.5rem 0;
        }

        .item .br em {
            font-style: normal;
        }

        .swiper-container-horizontal > .swiper-pagination-bullets {
            top: 0;
            bottom: auto;
            background: #fff;
            border-bottom: 1px solid #d1d1d1;
        }

        .swiper-pagination-bullet {
            width: auto;
            height: auto;
            opacity: 0.6;
            background: none;
            padding: 0.2rem 0.4rem 0.15rem;
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
            font-size: 0.35rem;
        }

        .swiper-pagination-bullet-active {
            border-bottom: 6px solid #007aff;
            opacity: 1;
        }

        .swiper-lazy-preloader {
            text-align: center;
            width: 1rem;
            height: 1rem;
            -webkit-animation: none;
            -o-animation: none;
            animation: none;
            display: block;
            margin: -0.5rem 0 0 -0.5rem;
            text-align: center;
            line-height: 1rem;
            opacity: 0.6;
        }

        .swiper-lazy-preloader:after {
            background: none;
        }

        .wrap {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .swiper-container-h {
            border-bottom: 1.2rem solid #222729;
            box-sizing: border-box;
        }

    </style>

{{/extend}}

{{#extend "mStyle"}}

    <style>
        html, body {
            position: relative;
            height: 100%;
            flex: 14px;
        }

        body {
            background: #fff;
            font-size: 14px;
            color: #000;
            margin: 0;
            padding: 0;
        }

        .wrap {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .menu .home {
            background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACABAMAAAAxEHz4AAAALVBMVEUAAAD///////////////////////////////////////////////////////+hSKubAAAADnRSTlMAEJjfqrQwf+9KByBly5hzyxgAAAHrSURBVGje7Ze7SgNBFIY3ISR4QQRrJU8gSPrgE9gpYhFstJTt7OysBPEJJI1lwDKlTyDYWoga4wXieQYzZJazS5RvZ6bQ4PyNopwvP+fyM0miokqokQYCbkdh9YsiN2EGRIIszMlYFwGAS/l8kI8gAxsrIRaOZLBcacurb319bCBJxhb2vQ28XyfJwrmnBVN5Zn72DcdHfeu9LgbkLtM97aUHwDRPm+lhwGyQ7pO7hZ5ZIF2oe9f6+YkBtdB1BFxN7lives8RsCWj4lm/uNVXMwNqoekEWJe3pKATeXaKUpEU/jIl+ryiJzbQnOoKWcCem7mgdOqwGRSlw+43u9mheKXN71G80u1VMOHh+jleKX844SkB+2QBMtjmNGe5F51dYsJDn6DDMCmcMe8KJjxvKye83gtfGmc53zpnOacNpBblHWc5Jy6j2SiT2am2d7McoKbDgu7StHi+vC/whoDXB+w43AxeGV0t3jnmBicNJxdnHWcnpy2nt77oXb8LYJRivGpHpGWUlnwBtYxE+74qVs2yj0iru2wxfQF2+autidrlAQNbUixYKw94yn6NgAiIgFkANI5zSj0AS5LT44wCdg6tDvwA+mSqRUAEREAEREAE/ArgdDunTh4wzP9n90dAUXlAUX8WEPWP9QVCcLlSf5YsUAAAAABJRU5ErkJggg==") no-repeat center;
        }

        .menu .explorer {
            background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACABAMAAAAxEHz4AAAAMFBMVEUAAAD///////////////////////////////////////////////////////////87TQQwAAAAD3RSTlMAWvINeqOMOt4tyR0Ft0e/N31wAAACv0lEQVRo3u1ZPWgUURDeeLl4euE4ELU8QfAHiz1F/CkkAUEQhGhrxPhX2OXUVlEUbFfUShBtLCzkDsH+CsXSws7CtbE+bjW6Hl6+kJDkhcx7O2/zdWG/7t7szH0zO2/evNmgQIEsHN/17SFw4N3VOxtS33oTq3jcyq0+/jMEDJLL3Xz6h2ewDnM78ugfxSLSNzd2Pzt568zFCIs47a//cYn+hebK79LOJTfO+eqPRAD23V279PkagLTup1+LgOTs+tXnIZD+8NGvxiv+yrgMO4GO2wCu2wTHAOz3CACAabvoAwA9DLPAW5fsBfBH0z8F/HZLp4CvSgQjw9LuX9rRIngwS/5UiWM1xKCT+UAbSdYDJ4BLQSY+AY8yxLGJoDuOQ7dwDDivGSgDV5zCBgZdtdK00XcWMeBQoOI90HKLnugGtrn/Jhbk7I66wlgDJn0MjAL2ulDBIPBCGw8c1P75GXhld3U8MkmgpULatbvW8TNQtQfriCkWetHZa03yX74GJmxbpmR4+bzIpqXYJGZRQSm0lK2yoaVjyvLCvpgs8MmE/2Kthz3+BrZgXqzNmDqhYwxzYi1EK0f7g0QuoZujAQJaCikBzeEK+nkMNMSOnlASWX38vjHpgwr+Ck6v8xjYLjyeNcnpg7LY+7EIq5JJQ1EoJ/MYGBUFOBIbVOmkUlsmM7ksTjX1fBMGmnkMlMAboF2gg0i/RjqR6FSmNxO9nemCQpc0uqjSZZ0+WNijjT5c6eOdbjDoFodusug2j2006VaXbrbpdp+9cNBXHvrSxV776IsnffVlL9/09Z8dQNAjEHoIw46B6EEUPQrjh3Evv5PjwBh1biAZoc+NRHtAnRrKjgB9bizcAOrEYFqhoIzGDQViOK9QUD4PGArEBwqFgvaJxFAgIChoKChsXgo1mkIPg4CkMAw43JsOChRYxgID84stpiXD8gAAAABJRU5ErkJggg==") no-repeat center;

        }

        .menu .sk {
            background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAPFBMVEUAAAD////////////////////////////////////////////////////////////////////////////YSWgTAAAAE3RSTlMAK+ugq2iPDbwcNQT2XHxx2c5KF0I7QgAAA6dJREFUeNrEl912pCAQhAUBQeRH+/3fdVcsBzIzmXFV2O8iORqVprqqOenOYRapeqHnyHmcteiVXEzXCBZEpLdEEVhXFybFRB+ZhKxWhPGcMnOvfJBuWZwMXvUzZbiv0I7BaQK8R8NfbNFzAtoN925ePRZ35uOD7lGEuk8G1qO/ih16XMEnPbtneUEJsdjuIHbZ32HXew/x/fDz9uh8OQe8G58e8GjERS+4KWkfis/Y0evpbQK1H21RQtjedVfU1+kT0maTBU0f0cHkUuWUbp3ug4SIZRS/gwiWDZTnup+MNLMiC4fp81tzMuMJJ4wcteNS0z+hxx868vGU/NG8LH+iBBNPtEGl7lt8QdApBOq329e649jU7gUXgU4TsIUlGcMett8qODdQP9IF4ggR+dqU4eD6c9H+QBcJhRHm4dj6KBZaXCR/6mAFdn1Q2BzFyyCCVqzVfPdBv66frXMLsLNYnXgkfyhT0m3ILK76Pn/i1ihPN+I3H8RvE2nM+VN0KyqncfwQgPXvJu//fg3MusPfoyAehpF0O/JhbPHJAOrV//dmQf1uA7Ya0MIK94Pm29WIrHuHTgaAFWrAh90GunuDe2ijqRL60Wn3JgET0Xzk/Ll+Ms1E0/B2BLJ6BihtwF4HIm7CJBWJttxsidhlCVSVsLdbvAog4dG6mN2H7PkQniyUqAl2bqeng9ns4oxUnXFvtHmKwIARUBudXFAEAZe+kQCQwG9bBq6dAKUErjwFBLLQAga369KCC7JQH/h/KWzokcGBGjEgiR4FcDjSUSMcksfzFGSwQht0XnZFohRDzTAQXnYrArYI1IwAy4tuZUJTNDVDw3JT6gUksdQQi5azTXmOMdyOESYIhQU8NcQXJogwo6aGaMQv/v21z+GJGjLt03izgsEcbsjQYWmU0dSDcCHEl0QzUtkSh/9QZKfah6CMgUo/cNEObDptXqAaQU0RUF10GkeDpqZoHH86GQGGaAeMnwIQ4chITYlIXuw4BiGnpnCMQv7/C/jTvB0QAQzDMAzkz9oofC8MW9vElvgn4D8hP4b8IuJXMX+M+HPMBxI+kvGh1I/lfDHhqxlfTvl67gMKHtHwkIrHdD6o5FEtD6t9XM8LC17Z+NKK13a+uOTVrS+veX3vAQaOcHiIxWM8HGTyKJeH2TjO54FGj3R6qNVjvRxs9mi3h9s93u8Fh4Di4SUXr/l40SmgennZLaD7eeExoHwGpNeA9hsQnwvqd0F+P+j/A5qINVZe7ufoAAAAAElFTkSuQmCC") no-repeat center;

        }

        .menu .message {
            background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACABAMAAAAxEHz4AAAAMFBMVEUAAAD///////////////////////////////////////////////////////////87TQQwAAAAD3RSTlMAMJRoqla/fgcSRCDW6vjnLwjjAAADIklEQVRo3u2ZTWgTURDHp58macEIgqBCShUEe0gQQW+pF79K3VwEwUMKXtRLehNB2IDiqUqtaG9tvSsp4smDigfRg+QmFg8rnvQUmm4StJv9u/2wu3azb957nqT7u+SQzeS9mXn/mTdLMTuCMv0TD8fbZxZJn74agBXSJmFgjWukyy6sY5MuGeDoSxMokCZV/CLqsvCd9Ehu/HcFy6RHCm3y6MeKtg/tjY866dGNum9Hhz445NGLFukxAKS9j9deLDSp4QNRooSfpEke7UuJp8AkadKPdZyyZh4dt7DBFa0T/aiELZwRUmYv/uIUKfICazSHbwwf/og1rpMSs/D4dnlzMxfgcU5Zys77zt9XA9yCgpRlAfckBbhtAfY0yfIYwM1ta7KALyRJlwWM0TZmADdNclSABoV4BtlD1QW00x0SsySrrq8iKsEdyIlj0opSoCxcmUMxBVyNrDPviceMPr4GbCkXLgkWx7txEIgM90ANnyVkrCXKkBYbA6GjeoFFvqKnhUI/wRi4j7o4RKusC1Y5+2KqGBXv0C0zFR0LTLUrMAXZISEG48VBrpmoMIVynjuxuxlVKeIrUy6ZXMxilEu0JomwkCMuTMI4AmmmZIifSAJc9bCwIM4TvnstCOXIJYYSckIXOcRgCDumHjSJIYuh2EBsIDYQG4gN/DcGbGIwBfVbaliRFxqY4lvZIn4IN9jgZ0vNsqjPneAHK4I9mHwvTQkr2tE9Uhe7DCIDWQQKUleaVmT/tCJ5L81FrW1SbryERsSFqE5S5Dt35PeAUek55SqFMfwM4cjCKXeK4RJJcrdTJDP+xZglUe3gxqrK3HIu3NGmlCZmfeGn+9UmZkboDpxRm7zOh5xgYkJtWmpLaKWS+uZRfzItHcb9JuyQDxRphNakyFBYzpQIy1rylgVp3Lcd0/7BHp+DcC4GMLAc+PIAhWAmGUlprQj+5E0wbzxziphBha1ozOfnAtqbgsY7ilRA/ou+MQXMrbHmjN6Lnu4/4+jnAM6SBiaAT4dOjAOwy6RByk/NHGkxg03GSJNZCx7uCGkzcOz0uyNpionh+A1F1/VYWiBEJwAAAABJRU5ErkJggg==") no-repeat center;

        }

        .menu .my {
            background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAM1BMVEUAAAD///////////////////////////////////////////////////////////////+3leKCAAAAEHRSTlMABZPivakmN1ry0m0ZgEgOCMYe9QAAA2hJREFUeNrtWtty4yAMFZg75vL/X7t1vanT8W4MHAjTjs9bJoklS0cSSKIbN24ASEob76NeGb0dq5FLfoLj8Y1a6ODyPyD8Sm8AM0+vbp0Uzj7poGk0HuIXHlX6cog28j0qxF288+psGc33L6WiUVhF3sD/62q9cyPQGGh7/YLxUwWRaADM7uIikiz93cD4Jt/TNdInH01v+Zv7bSHD/UlXHHLj/locLN1tEDb2sYp42Yig+/JPMKqAsjnbbkzUG68T8B8Q6/Y2a5PVqAv45s823kTqANUaU+7DCYxwyNbn6ENzlIGmWXUL8PAwpGtlL1YZj6SmkfyFsoAjwZQ6BILN2UAE5jgFE5TDLUEIWDpLcE1awFAWUBzsgbQSAJ+zAylgYQ6BBwFHqAkZZkFJCNiHAgoLAg7nEY1VwgCXEoNFkYGLuf/JCkx3wXQSTg/D6YloeiqeXoyml+P5BxK9+QA8ksFx7LFD6U8/lk+/mEy/ms2/nH4+hmGq4w2K0Nqg+BUtGkp2q6lNTapf0qZralTmU2sPgq9s1apTqxYFr29Wx3nt+jCgXU8s1A0sInVHrBjZOEUDoJaCodX+G0ZDwOTFYDC6PML9Zwku6LN2kdsL/XqqkC2Pan3I3ke3ZeJxRPE8vBZiscdnrmg82EODM7im0VBe5Few0qw0CsnwJ2svTkjOgw+By+9LBC4M2aZY+ZdoGYw6iUjacPFQw3o2Srw0qchF1rP+4pegSzwV//7asF7iw+5aU86WYDuqYI7dkLpVlz5FifHWBxnbY4aulrbqchwMZMLXNprtGC24zmGA4noYwSpIfiQIAdDA7OdQEL5ZA3PyH/AeqvE+1qWyxaZbWlpON1LIBrKhw5hjz3uVryev73uv0rUE4ITg7FDLgPUPGLquz2P6X+54DaeTLWdtzTNFjbZABoCtuo653onirl3YGdgbqjQU2UWHHjGBLHVWogGIhdQSQA66NG0AXIUjFNGQA4O2gvCKJVMWQ4MgC5KRAaYsMA1xCuJzUIZQsIhg8rpsMhqGeDnI9AU0AUe5Chg243BXJABOIiAJ8PVBfJqN7xvgGxH8OgvgmSDie0PgahS+djRuNcr2yYPtTgYupOBqFL52hK9G4WtH+GpUHJkGDiO/rBWeBkO8zMVJ0XAounHjxjf8AYGARL50i4QHAAAAAElFTkSuQmCC") no-repeat center;

        }

        .menu a.home,
        .menu a.explorer,
        .menu a.sk,
        .menu a.message,
        .menu a.my {
            background-size: auto 70%;
        }

        .menu a.sk {
            background-size: auto 90%;
        }

        .menu {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 1.2rem;
            display: flex;
            z-index: 10;
            flex-direction: row;
            background: #222729;
        }

        .menu a {
            flex: 1;
            line-height: 1.2rem;
            text-align: center;
            background: #222729;
            text-decoration: none;
            font-size: 0.3rem;
            color: #fff;
        }

        .menu a.active {
            background-color: #000;
        }


    </style>

{{/extend}}

<div class="wrap">
    <div class="swiper-container swiper-container-h">
        <div class="swiper-wrapper swiper-wrapper swiper-wrapper-h">
            <div class="swiper-slide">
                <div class="swiper-container swiper-container-v">
                    <div class="swiper-wrapper" ajax="true" count="{{albumsNum}}">
                        <div class="refresh"><span>下接刷新</span>

                            <div class="refresh-icon"></div>
                        </div>
                        <div class="swiper-slide swiper-slide-v">

                            {{>"ajax_albums_box"}}
                        </div>
                    </div>

                    <div class="loader">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <!-- Add Scroll Bar -->
                    <div class="swiper-scrollbar"></div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-container swiper-container-v">
                    <div class="swiper-wrapper" ajax="true" count="{{albumsNum}}">
                        <div class="refresh"><span>下接刷新</span>

                            <div class="refresh-icon"></div>
                        </div>
                        <div class="swiper-slide swiper-slide-v">
                            <!--    {{>"ajax_albums_box"}}-->
                        </div>
                    </div>
                    <div class="refresh">下接刷新
                        <div class="refresh-icon"></div>
                    </div>
                    <div class="loader">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <div class="swiper-scrollbar"></div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="swiper-container swiper-container-v">
                    <div class="swiper-wrapper" ajax="true" count="{{albumsNum}}">
                        <div class="refresh"><span>下接刷新</span>

                            <div class="refresh-icon"></div>
                        </div>
                        <div class="swiper-slide swiper-slide-v">

                        </div>
                    </div>
                    <div class="refresh">下接刷新
                        <div class="refresh-icon"></div>
                    </div>
                    <div class="loader">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <div class="swiper-scrollbar"></div>
                </div>
            </div>
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination swiper-pagination-h"></div>
    </div>
    <div class="menu">
        <a class="active home" data-href="{{static}}m"></a>
        <a class="explorer" data-href="{{static}}m/explorer"></a>
        <a class="sk" data-href="{{static}}m/sk"></a>
        <a class="message" data-href="{{static}}m/message"></a>
        <a class="my" data-href="{{static}}m/my"></a>
    </div>
</div>
{{host}}

<script>
    var srwidth = document.querySelector('.swiper-wrapper').offsetWidth;
    var imgs = document.querySelectorAll('.box img');
    var boxs = document.querySelectorAll('.box');
    for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        var box = boxs[i];
        //img.style.cssText = `width:${srwidth}px;height:${parseInt(img.offsetHeight * srwidth / img.offsetWidth)}px`;
    }


    Image.prototype.load = function (url, boximg, callback) {
        var thisImg = this;
        var xmlHTTP = new XMLHttpRequest();
        xmlHTTP.open('GET', url, true);
        xmlHTTP.responseType = 'arraybuffer';
        boximg.nextElementSibling.innerHTML = '0%';
        xmlHTTP.onload = function (e) {
            var blob = new Blob([this.response]);
            boximg.src = window.URL.createObjectURL(blob);
            boximg.setAttribute('class', 'swiper-lazyed');
        };
        xmlHTTP.onprogress = function (e) {
            thisImg.completedPercentage = parseInt((e.loaded / e.total) * 100);
            boximg.nextElementSibling.innerHTML = thisImg.completedPercentage + '%';
        };
        xmlHTTP.onloadstart = function () {
            thisImg.completedPercentage = 0;
            boximg.nextElementSibling.innerHTML = thisImg.completedPercentage + '%';
        };
        xmlHTTP.onloadend = function () {
            thisImg.completedPercentage = 100;
            boximg.nextElementSibling.style.display = "none"
        }
        xmlHTTP.send();
    };

    initImg();
    function initImg() {
        var swiperLazy = document.querySelectorAll('.lazy');
        for (var m = 0; m < swiperLazy.length; m++) {
            var url = swiperLazy[m].getAttribute('data-src');
            new Image().load(url, swiperLazy[m]);
        }
    }


</script>



{{#extend "mScripts"}}
    <script src="{{static}}mobile/js/swiper.min.js"></script>
    <script>
        //横滚动
        var swiperH = new Swiper('.swiper-container-h', {
            pagination: '.swiper-pagination-h',
            paginationClickable: true,
            onSlideNextEnd: function (swiper) {
                //自动刷新
                var activeV = swiperV[swiper.activeIndex];
                var pullDistance = window.devicePixelRatio * 100;
                if (activeV.container.data('refresh')) {
                    return;
                }
                activeV.container.data('refresh', true);
                activeV.setWrapperTranslate(pullDistance);
                activeV.setWrapperTransition(300);
                activeV.container.find('.refresh-icon').addClass('anim');
                activeV.container.find('.refresh span').html('正在加载中');
                window.setTimeout(function () {
                    var updateCreatedOn = activeV.container.find('.item').eq(0).attr('createdOn') || 0;
                    var url = '/m?q=update&createdOn=' + updateCreatedOn;
                    getajax(url, activeV, pullDistance)
                }, 300);
            },
            paginationBulletRender: function (index, className) {
                var str = '';
                switch (index) {
                    case 0:
                        str = '关注';
                        break;
                    case 1:
                        str = '精选';
                        break;
                    case 2:
                        str = '附近';
                        break;
                }
                return '<span class="' + className + '">' + str + '</span>';
            },
            spaceBetween: 50
        });

        //坚滚动
        var swiperV = new Swiper('.swiper-container-v', {
            scrollbar: '.swiper-scrollbar',
            direction: 'vertical',
            slidesPerView: 'auto',
            autoHeight: true,
            preloadImages: false,
            watchSlidesProgress: true,
            mousewheelControl: true,
            freeMode: true,
            // lazyLoading: true,
            onTouchStart: function (swipper) {
                swipper.setWrapperTranslate(swipper.getWrapperTranslate());
                swipper.update();
                swipper.container.data('onTouchEnd', 'false');
            },
            onTouchEnd: function (swipper) {
                var pullDistance = swipper.getWrapperTranslate();
                var realyDistance = pullDistance / window.devicePixelRatio;
                swipper.container.data('onTouchEnd', 'true');
                if (realyDistance > 50) {
                    window.setTimeout(function () {
                        swipper.container.find('.refresh span').html('正在加载中');
                    }, 10);

                    //刷新
                    swipper.container.find('.refresh-icon').addClass('anim');
                    var updateCreatedOn = swipper.container.find('.item').eq(0).attr('createdOn') || 0;
                    var url = '/m?q=update&createdOn=' + updateCreatedOn;
                    getajax(url, swipper, pullDistance)
                } else {
                    swipper.container.find('.refresh').css({
                        "z-index": 1,
                        transition: '400ms',
                        transform: "translate3d(0px,-1rem,0px)"
                    });
                    swipper.container.find('.refresh-icon').css({
                        transition: '400ms',
                        transform: "rotate(-360deg)"
                    });
                }

            },
            onProgress: function (swipper, progess) {
                var diff = swipper.touches.diff;
                var itemLength = swipper.container.find('.box').length;
                var count = swipper.wrapper.attr('count');
                var loaded = itemLength < count;
                var moreCreatedOn = swipper.container.find('.item').eq(itemLength - 1).attr('createdOn');
                var ajax = swipper.wrapper.attr('ajax');
                var pullDistance = swipper.getWrapperTranslate();
                var realyDistance = pullDistance / window.devicePixelRatio;
                if (ajax == 'false' && loaded) {
                    swipper.container.find('.loader').css('display', 'block');
                }

                if (itemLength >= count) {
                    swipper.container.find('.loader').css({
                        'left': '0',
                        'display': 'block',
                        'width': '100%'
                    }).html('没有更多的数据了');
                }
                if (realyDistance > 50) {
                    swipper.container.find('.refresh span').html('松开刷新');
                }
                if (realyDistance > 0 && realyDistance < 50) {
                    swipper.container.find('.refresh span').html('下拉刷新');
                }
                if (realyDistance > 0 && swipper.container.data('onTouchEnd') == "false") {
                    var transformY = pullDistance * 1.3;
                    if (realyDistance > 50) {
                        var transformY = 60 * window.devicePixelRatio;
                    }
                    swipper.container.find('.refresh').css({
                        "z-index": 2,
                        transition: '0ms',
                        transform: "translate3d(0," + transformY + "px,0)"
                    });
                    swipper.container.find('.refresh-icon').css({
                        transform: "rotate(" + (pullDistance * 15) + "deg)"
                    });
                }

                if (progess >= 1 && diff < 0 && ajax == 'true' && loaded) {
                    swipper.wrapper.attr('ajax', 'false');
                    var url = '/m?q=more&createdOn=' + moreCreatedOn;
                    getajax(url, swipper, diff)
                }

            }
        });
        //请求新的图片
        function getajax(url, swipper, diff) {
            $.ajax({
                type: 'get',
                url: url,
                catch: false,
                /*dataType: 'json',*/
                timeout: 10 * 1000,
                success: function (data) {
                    setitem(data, swipper, diff);
                },
                error: function (xhr, type) {

                },
                complete: function () {
                    if (diff < 0) {
                        //加载更多
                        swipper.wrapper.attr('ajax', 'true');
                        swipper.container.find('.loader').css('display', 'none');
                    } else {
                        swipper.container.find('.refresh').css({
                            "z-index": 1,
                            transition: '400ms',
                            transform: "translate3d(0,-1rem,0)"
                        });
                        swipper.container.find('.refresh-icon').removeClass('anim').css({
                            transition: '400ms',
                            transform: "rotate(0deg)"
                        });

                        swipper.setWrapperTranslate(0);
                        swipper.setWrapperTransition(300);
                    }
                }
            });
        }
        //设置新的图片
        function setitem(taove, swipper, diff) {
            if (diff < 0) {
                //加载更多
                swipper.slides.append(taove);
            } else {
                //刷新
                swipper.container.find('.time').each(function () {
                    var html = timeago(parseInt($(this).attr('createdOn')));
                    $(this).html(html);
                });
                swipper.wrapper.attr('createdOn', taove.count);
                swipper.slides.prepend(taove);
            }

            /*  $('.box').find('img').each(function () {
                  var This = $(this);
                  This.css({
                      width: srwidth,
                      height: this.attr('height') * srwidth / this.prop("width")
                  })
              });*/
            initImg();
            swipper.update();
        }

        //时间
        function timeago(date) {
            date = new Date(date);
            var seconds = Math.floor((new Date() - date) / 1000);
            var interval = Math.floor(seconds / 31536000);
            if (interval > 1) {
                return "" + interval + "年";
            }
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) {
                return "" + interval + "月";
            }
            interval = Math.floor(seconds / 86400);
            if (interval > 1) {
                return "" + interval + "天";
            }
            interval = Math.floor(seconds / 3600);
            if (interval > 1) {
                return "" + interval + "小时";
            }
            interval = Math.floor(seconds / 60);
            if (interval > 1) {
                return "" + interval + "分";
            }
            if (Math.floor(seconds) === 0) {
                return '刚刚';
            } else {
                return Math.floor(seconds) + '秒';
            }
        }


        //喜欢请求
        $(function () {
            $('body').on('doubleTap', '.box', function () {
                /*var name=$(this).attr('img-name');
                $(this).parent().find('.bigLike').toggleClass('active');*/
                postLike(this)
            });

            $('body').on('tap', '.bigLike', function () {
                /*                var name=$(this).attr('img-name');
                                $(this).parent().find('.bigLike').toggleClass('active');*/
                postLike(this);

            });


            function postLike(obj) {
                var This = $(obj);
                var name = This.attr('img-name');
                var likenum = 0 + This.parent().find('.like-num').html();
                This.parent().find('.bigLike').toggleClass('active');
                if (This.parent().find('.bigLike').hasClass('active')) {
                    likenum++;
                } else {
                    likenum--;
                }
                This.parent().find('.like-num').html(likenum);
                $.post('/m', {name: name}, function (data) {
                    if (!data.sucess) {
                        /* This.parent().find('.bigLike').toggleClass('active');
                         likenum--;
                         This.parent().find('.like-num').html(likenum);*/
                    }
                })
            }
        });


    </script>


{{/extend}}
{{#extend "mScripts"}}
    <script>
        store.set('username', '{{loginInfo.phone}}')
        var loginW='';
        var waiting=null;
        //用到dcloud--------------------------------------
        if (window.plus) {
            plusReady();
        } else {
            document.addEventListener("plusready", plusReady, false);
        }

        function plusReady() {
           // plus.navigator.setStatusBarBackground("#fff");
            //plus.navigator.setStatusBarStyle("UIStatusBarStyleBlackOpaque");
            plus.navigator.setStatusBarStyle("UIStatusBarStyleDefault");
            var subpages = ['{{static}}m/explorer', '{{static}}m/sk', '{{static}}m/message', '{{static}}m/my'];
            var subpage_style = {
                zindex: 2,
                top: '0',
                bottom: $('.menu').height() / window.devicePixelRatio + 'px'
            };

            var aniShow = {};

            //创建子页面，首个选项卡页面显示，其它均隐藏；
            var self = plus.webview.currentWebview();
            for (var i = 0; i < subpages.length; i++) {
                var sub = plus.webview.create(subpages[i], subpages[i], subpage_style);
                sub.hide();
                self.append(sub);
            }
            //当前激活选项
            var activeTab = '';
            //选项卡点击事件
            $('.menu').on('tap', 'a', function (e) {
                if (!store.get('username') && this.getAttribute('data-href') == '{{static}}m/my') {
                    if (loginW) {
                        plus.webview.show(loginW, "slide-in-right");
                    } else {
                        waiting=plus.nativeUI.showWaiting();
                        loginW = plus.webview.create("{{static}}m/login", "{{static}}m/login", {
                                    zindex: 2,
                                    top: '0',
                                    bottom: '0',
                                    background:'#1da1f2',
                                    'popGesture':'hide'
                                },
                                "slide-in-right");
                        loginW.onloaded=function(){
                            plus.webview.show(loginW, "slide-in-right");
                            waiting&&waiting.close();
                            waiting=null;
                        }
                    }

                    return;
                }
                var targetTab = this.getAttribute('data-href');
                $(this).addClass('active').siblings().removeClass('active');
                if (targetTab == activeTab) {
                    return;
                }


                if (targetTab == "{{static}}m") {
                    plus.webview.hide(activeTab);
                    activeTab = '';
                    return;
                }
                plus.webview.show(targetTab);
                plus.webview.hide(activeTab);
                activeTab = targetTab;

            });

        }


    </script>
{{/extend}}